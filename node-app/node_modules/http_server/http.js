#!/usr/bin/env node 
var http = require('http');
var fs = require('fs');
console.log(1)
var path = require('path');
var mime = require('mime');

var server = http.createServer(function(req,res){
    if (req.url === '/favicon.ico') {
        res.end();
        return;
    }
	var staticPath = path.resolve('.',req.url);
    console.log(staticPath)
	if(fs.existsSync(path.join(staticPath,url+'/index.html'))){
		url = path.join(url,'index.html');
        res.setHeader('Content-type',mime.lookup(url));
        fs.createReadStream(url).pipe(res);
	}else{
		console.log(fs.statSync(path.join(staticPath,url)))
        if(fs.statSync(staticPath).isDirectory()){
        	var dirs = fs.readdirSync(path.join(staticPath,url));
        	// html/
        	var str = "<ul>";
        	// a.html
        	dirs.forEach(function (item,index) {
                if(fs.statSync(path.join(staticPath,item)).isDirectory()){
                   str+= "<li><a href='"+staticPath+url+"/'>"+item+"</a></li>" 
                }else{
                   str+= "<li><a href='"+staticPath+url+"'>"+item+"</a></li>" 
                }
				
            })
			str+="</ul>"
            console.log(str)
            res.setHeader('Content-type','text/html');
        	res.write(str);
        	res.end();
		}else{
        	if(fs.existsSync(path.join(staticPath,url))){
                res.setHeader('Content-type',mime.lookup(url));
                fs.createReadStream(path.join(staticPath,url)).pipe(res);
			}else{
        		res.statusCode = 404;
        		res.end();
			}
		}
	}
});

server.listen(9999,function(){
	console.log("this server url is : http:localhost"+server.address().port);
})